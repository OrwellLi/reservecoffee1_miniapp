<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Reserve Coffee • Поиск мест</title>
    <link rel="stylesheet" href="style.css" />

    <!-- ГАРАНТИРОВАННО РАБОЧАЯ ЗАГРУЗКА ЯНДЕКС КАРТ НА VERCEL -->
    <script>
        // Vercel автоматически добавляет переменные в window.__vercel_env__
        // Это официальный способ 2025 года для статических сайтов
        const apiKey = window.__vercel_env__?.VITE_YANDEX_API_KEY;

        if (!apiKey || apiKey === 'undefined' || apiKey.trim() === '') {
            document.addEventListener('DOMContentLoaded', () => {
                document.body.innerHTML = `
                    <div style="position:fixed;top:0;left:0;right:0;bottom:0;background:#fff;z-index:9999;padding:20px;text-align:center;font-family:system-ui,sans-serif;color:#333;">
                        <h2>Ошибка загрузки карты</h2>
                        <p>API-ключ Яндекс.Карт не найден в Vercel</p>
                        <p style="background:#f0f0f0;padding:10px;border-radius:8px;margin:15px 0;">
                            Перейди в проект → Settings → Environment Variables<br>
                            Добавь: <code>VITE_YANDEX_API_KEY = твой_ключ</code>
                        </p>
                        <small>Текущий ключ: <b style="color:red;">${apiKey || 'отсутствует'}</b></small>
                    </div>`;
            });
            console.error('YANDEX API KEY НЕ НАЙДЕН! Добавь VITE_YANDEX_API_KEY в Vercel');
        } else {
            console.log('Ключ Яндекс.Карт успешно получен:', apiKey.substring(0, 10) + '...');
            const script = document.createElement('script');
            script.src = `https://api-maps.yandex.ru/v3/?apikey=${apiKey}&lang=ru_RU`;
            script.async = true;
            script.onload = () => console.log('Yandex Maps API загружен');
            script.onerror = () => console.error('Ошибка загрузки Yandex Maps API');
            document.head.appendChild(script);
        }
    </script>
</head>
<body>
    <!-- Остальной HTML без изменений -->
    <header><h1>Поиск кофеен рядом</h1></header>
    <nav class="tabs">
        <button class="tab-btn active" data-tab="nearby">Рядом</button>
        <button class="tab-btn" data-tab="search">Поиск</button>
        <button class="tab-btn" data-tab="favorites">Избранное</button>
    </nav>
    <main>
        <section id="nearby" class="tab-content active">
            <div id="nearby-map"></div>
            <p id="geo-status" class="status">Определяем ваше местоположение...</p>
        </section>
        <section id="search" class="tab-content">
            <div class="search-container">
                <input type="text" id="search-input" placeholder="Название, адрес, метро..." />
                <button id="search-btn">Найти</button>
            </div>
            <div id="search-map"></div>
        </section>
        <section id="favorites" class="tab-content">
            <ul id="favorites-list"></ul>
            <button id="clear-fav" class="danger-btn">Очистить всё</button>
        </section>
    </main>

    <script src="script.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        if (window.Telegram?.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
        }
    </script>
</body>
</html>